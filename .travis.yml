language: c
sudo: required
branches:
  only:
    - master
services:
  - docker
env:
  - OS=ubuntu-16.04
  - OS=fedora-25
  - OS=opensuse-leap
before_install:
  - |
      mkdir tmp
      sudo docker pull "cangjians/build-essential:${OS}"
      sudo docker tag "cangjians/build-essential:${OS}" "cangjians/build-essential:latest"
      echo
      echo OS=$(sudo docker run -it --rm "cangjians/build-essential:latest" -c "cat /var/version")
      echo ---------------
      git clone -b docker https://github.com/Cangjians/libcangjie.git tmp/libcangjie
      sudo docker build -t "cangjians/libcangjie" tmp/libcangjie/.
      sudo docker build -t "cangjians/pycangjie" .
script:
  - |
      sudo docker run -it --rm "cangjians/pycangjie" make check distcheck
